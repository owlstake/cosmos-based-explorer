{"ast":null,"code":"import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.find-index.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { BTable, BCard, BCardHeader, BCardTitle, VBTooltip } from 'bootstrap-vue';\nimport { getCachedValidators, getStakingValidatorByHex, toDay } from '@/libs/utils'; // import fetch from 'node-fetch'\n\nexport default {\n  components: {\n    BCard: BCard,\n    BTable: BTable,\n    BCardHeader: BCardHeader,\n    BCardTitle: BCardTitle\n  },\n  directives: {\n    'b-tooltip': VBTooltip\n  },\n  data: function data() {\n    return {\n      islive: true,\n      blocks: [],\n      list_fields: [{\n        key: 'height',\n        sortable: true\n      }, {\n        key: 'hash',\n        thClass: 'd-none d-lg-block',\n        tdClass: 'd-none d-lg-block text-truncate'\n      }, {\n        key: 'proposer',\n        tdClass: 'text-truncate'\n      }, {\n        key: 'txs'\n      }, {\n        key: 'time',\n        thClass: 'd-none d-md-block',\n        tdClass: 'd-none d-md-block'\n      }]\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    this.$http.getLatestBlock().then(function (res) {\n      _this.blocks.push(res);\n\n      var list = [];\n      var height = res.block.header.height;\n\n      for (var i = 1; i < 10; i += 1) {\n        list.push(height - i);\n      }\n\n      if (!getCachedValidators()) {\n        _this.$http.getValidatorList();\n      }\n\n      var promise = Promise.resolve();\n      list.forEach(function (item) {\n        promise = promise.then(function () {\n          return new Promise(function (resolve) {\n            _this.$http.getBlockByHeight(item).then(function (b) {\n              resolve();\n\n              _this.blocks.push(b);\n            });\n          });\n        });\n      });\n      _this.timer = setInterval(_this.fetch, 6000);\n    });\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.islive = false;\n    clearInterval(this.timer);\n  },\n  methods: {\n    length: function length(v) {\n      return Array.isArray(v) ? v.length : 0;\n    },\n    formatTime: function formatTime(v) {\n      return toDay(v, 'time');\n    },\n    formatProposer: function formatProposer(v) {\n      return getStakingValidatorByHex(this.$http.config.chain_name, v);\n    },\n    fetch: function fetch() {\n      var _this2 = this;\n\n      this.$http.getLatestBlock().then(function (b) {\n        var has = _this2.blocks.findIndex(function (x) {\n          return x.block.header.height === b.block.header.height;\n        });\n\n        if (has < 0) _this2.blocks.unshift(b);\n        if (_this2.blocks.length > 200) _this2.blocks.pop();\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}